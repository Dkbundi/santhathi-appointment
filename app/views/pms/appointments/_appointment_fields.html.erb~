<div id="calendar_display">
  <div id="datepicker"></div>
  <br />
  
  <%= text_field_tag 'date' %>
   
</div>

<div id="app_details">

  <table cellpadding="5px" class="form-table">
     <tr> <th><%= f.label :department %></th>
          <td><%= select :departament, :id, [['Select department' , '']] + Department.departments_for_select_list %> <%= image_tag("spinner.gif",
              :align => "absmiddle",
              :border => 0,
              :id => "spinner1",
              :style =>"display: none;" ) %></td> 
     </tr>

     <tr id ='doctor-list'>
       <th><label>Doctor</label></th>
       <td>
           <div id="doctors">
              <%=render :partial => 'doctors_list', :locals => {:f => f, :doctors => doctors_list} %>
           </div>
       </td> 
     </tr>
      <tr id = 'appointment_time'><th><label>Appointment time </label></th>
          <td> <%= f.select :hour, hours, :selected => (@hour || 9) %> <%= f.select :minute, minutes, :selected => (@minute || 30) %> </td> </tr>

     <tr> <th><%= f.label :reason %></th> <td><%= f.select :reason_id, [['Select reason' , '']] + Reason.select_list %></td> </tr>

     <tr> <th><%= f.label :mode %></th> <td><%= f.select :mode_id, [['Select mode' , '']] + Mode.select_list %></td> </tr>

     <tr> <th><label> Visit type</label></th>
          <td><%= radio_button_tag ('appointment[visit_type]', 'yes', checked = params[:patient_id].blank?,
                    options ={:onclick => "jQuery('#new_patient').show(); jQuery('#new_patient').highlight(); jQuery('#patient_search').hide(); "})%> First visit &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <%= radio_button_tag ('appointment[visit_type]', 'no', checked = !params[:patient_id].blank?,
                    options ={:onclick => "jQuery('#patient_search').show(); jQuery('#new_patient').hide(); jQuery('#patient_search').highlight();"})%> Follow up visit        
          </td>
     </tr>
  </table>
  
<br />
<br />
<br />


<div id='new_patient'>
   <% fields_for :patient do |patient| %>
      <%=render :partial => 'new_patient', :locals => {:patient => patient} %>
   <% end %>
   <br />
</div>

<div id='patient_search' style="display:none">
   <%=render :partial => 'patient_search'%>
</div>


<input type="hidden" name="patient_id" value= '<%=params[:patient_id]%>'>



<%= observe_field(:date, :frequency => 0.5,
                    :before => "jQuery('#spinner').show();",
                    :success => "jQuery('#spinner').hide();",
                    :url => pms_appointments_url,
                    :method => :get,
                    :with => "'date=' + value+'&doctor=' + jQuery('#appointment_doctor_id').val()"
                  ) %>

 <%= observe_field(:departament_id, :frequency => 0.5,
                    :before => "jQuery('#spinner1').show()",
                    :success => "jQuery('#spinner1').hide(); jQuery('#doctor-list').highlight();",
                    :url => update_doctors_list_pms_appointments_url,
                    :method => :get,
                    :with => "'department_id=' + value"
                  )%>

<%= observe_field(:appointment_doctor_id, :frequency => 0.5,
                    :before => "jQuery('#spinner').show();",
                    :success => "jQuery('#spinner').hide();",
                    :url => pms_appointments_url,
                    :method => :get,
                    :with => "'doctor=' + value +'&date=' + jQuery('#date').val()"
                  ) %> 
</div>
