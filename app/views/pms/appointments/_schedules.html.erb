<div id="schedule">
<%= image_tag("spinner.gif",
              :align => "absmiddle",
              :border => 0,
              :id => "spinner",
              :style =>"display: none;" ) %>

<table style = "margin-bottom: 8px;"> 
     <tr><td>Available:  &nbsp;</td>
         <td style="width: 15px; border: #ddd 1px solid; background: #D7F6C6"> </td> 
         <td> &nbsp; &nbsp; </td>
         <td>Not Available:  &nbsp; </td>
         <td style="width: 15px; border: #ddd 1px solid; background: #F7F7F7"></td> 
         <td> &nbsp;  &nbsp; </td>
         <td>Booked:  &nbsp; </td>
         <td style="width: 15px; border: #ddd 1px solid; background: #FFF9BD"></td> 
      </tr>
</table>

<table class="time-slots" cellspacing="0">
    <thead><tr>
              <th><b>Slot</b>&nbsp; </th><th><b>Name</b> </th> <th><b>Register No</b></th>
           </tr>
    </thead>
     <tbody style="overflow-y: scroll; overflow-x: hidden; height: 380px;">
     <%unless @doctor.blank? %>
       <% dt1 = Time.parse(@doctor.doctor_profile.working_from.to_s) %>
       <% appoitments_hash = appointments(@doctor, @date) %>
       <% working_slots = working_slots(@doctor, @date) %>

       <% iteration_count(@doctor).times do%>
         <% slot = "#{(dt1.strftime('%H:%M').to_s)}" %>
         <% if appoitments_hash.key?(slot) %>
            <tr class="appointment">
               <td>
                 <%= link_to "#{(dt1.strftime('%H:%M').to_s)} - #{(dt1 = dt1 + 5.minutes).strftime('%H:%M').to_s}", pms_appointment_url(appoitments_hash[slot]), :rel=> "facebox" %>
               </td>
               <td><%= link_to appoitments_hash[slot].patient.patient_name, pms_patient_url(appoitments_hash[slot].patient), :rel=> "facebox" %> </td>
               <td> <%= appoitments_hash[slot].patient.reg_no %> </td>
            </tr>
         <% elsif working_slots.include?(slot) -%>
            <tr>
               <td class="available">
                   <%= link_to_function("#{(dt1.strftime('%H:%M').to_s)} - #{(dt1 = dt1 + 5.minutes).strftime('%H:%M').to_s}", "setTime('#{slot}')") %> </td>
            <td class="available-new"> &nbsp; </td>
            <td class="available-new"> &nbsp; </td>
            </tr>
        <% else %>
           <tr>
            <td  class="not-working">
              <%= "#{(dt1.strftime('%H:%M').to_s)} - #{(dt1 = dt1 + 5.minutes).strftime('%H:%M').to_s}" %>
            </td>
            <td class="available-new"> &nbsp; </td>
            <td class="available-new"> &nbsp; </td>
            </tr>
          <% end %>

       <%end%>
     <%end%>
   </tbody>
</table>

<script type="text/javascript">
  function setTime(time){
      hour = time.substring(0,2)
	  minute = time.substr(3,2)
	  $("appointment_hour").value = parseInt(hour * 1)
	  $("appointment_minute").value = parseInt(minute * 1)
    }
</script>
     </div>


