<br />

<%= image_tag("spinner.gif",
              :align => "absmiddle",
              :border => 0,
              :id => "spinner",
              :style =>"display: none;" ) %>

<table class="listing">

  <tr>
    <th></th>
    <th><%= remote_order_by_link(:id,:text =>"NO") %></th>
    <th><%= remote_order_by_link(:appointment_date, :text => "Date") %></th>
    <th><%= remote_order_by_link(:appointment_time, :text => "Time") %></th>
    <th><%= remote_order_by_link({:doctor => :name}, :text => "Doctor") %></th>
    <th><%= remote_order_by_link({:patient => :patient_name} , :text => "Patient") %></th>
    <th>Reason</th>

    <th><%= remote_order_by_link :state %></th>
    <th><%= remote_order_by_link ({:patient => :reg_no}, :text => "Reg.No" )%></th>
    <!--<th>Details</th>-->
    <th NOWRAP = NOWRAP class='hide-for-print'><%="#{image_tag('show.png')} | #{image_tag('edit.png')} | #{image_tag('delete.png')}"%></th>
  </tr>
<% for appointment in @appointments %>
  <tr valign="top" class="<%= cycle('odd', 'even') %>">
  	<td class='radio-column'><%=radio_button_tag ('appointment', appointment.id, checked = false, options = {:onclick => "$('main_form').appointment_id.value=#{appointment.id};"})%></td>
    <td><%=h appointment.id %></td>
    <td><%=h appointment.appointment_date %></td>
    <td><%=h Time.parse(appointment.appointment_time.to_s).strftime('%H:%M').to_s %></td>
    <td><%=h appointment.doctor.name%></td>
    <td><%= link_to appointment.patient.patient_name, patient_url(appointment.patient), :rel=> "facebox" %></td>
    <td><%=h appointment.reason.name %></td>


    <td><%= appointment.state == 'new_appointment'? link_to('Confirm', confirm_appointment_url(appointment, :page => params[:page]), :method => :get, :confirm => 'This action will mark this appointment as patient visited. are you sure?') : status(appointment.state) %></td>

    <td><%= appointment.patient.reg_no.blank? ? link_to('Register', edit_patient_url(appointment.patient)) : appointment.patient.reg_no%> </td>

    <!--<td><%= link_to 'Appointments', patient_patient_appointments_url(appointment.patient), :rel=> "facebox" %></td> -->

    <td NOWRAP = NOWRAP class='hide-for-print'><%= link_to image_tag('show.png', {:title => 'Show', :border => 0}), appointment_url(appointment), :rel=> "facebox" %> &nbsp;|&nbsp; <%= link_to image_tag('edit.png', {:title => 'Edit', :border => 0}), edit_appointment_path(appointment) %> &nbsp;|&nbsp; <%= link_to image_tag('delete.png', {:title => 'cancel appointment', :border => 0}), appointment_path(appointment), :confirm => 'Are you sure?', :method => :delete %></td>

  </tr>
<% end %>
</table>

<table class='table-bottom'>
  <tr class="table-footer">
  	<td><%= link_to "<span>New appointment</span>", new_appointment_path, :class=> "button" %></td>
        <td><%= remote_per_page_select %></td>
        <td> 
         <% form_tag(appointments_url, :method => :get, :id => "goto") do %>
             <% fields_for @search do |f|%>
                     <%= f.text_field :page, :class => 'textbox-tiny' %></td>
             <%end%>
         <%end%>


        </td>
         <td> <% unless @appointments.blank? %>
                             <div class="pagination">
                                <%= remote_page_links %>
                             </div>
                           <% end %>
         </td>
  </tr>
</table>
<br />
<table class='table-top'><tr>
           <td class='hide-for-print'> 
               <%= link_to(image_tag("printer.png", :border => '0'), "javascript:print()") %> &nbsp; 
               <%= link_to_function("Print this Page", "javascript:print()") %> 
           </td>

           <td class='hide-for-print'> 
               <%= link_to(image_tag('excel.png', :border => '0'), appointments_url(:format => "csv", :search => @params) )%> &nbsp; 
               <%= link_to("Export This Page to CSV", appointments_url(:format => "csv", :search => @params) )%> 
           </td>

           <td class='hide-for-print'> 
               <%= link_to(image_tag("acrobat.png", :border => '0'), appointments_url(:format => "pdf", :search => @params)) %> &nbsp; 
               <%= link_to("Export This Page to PDF", appointments_url(:format => "pdf", :search => @params)) %> 
            </td>
         </tr>
</table>

<%= observe_form("goto", :frequency => 1,
                 :before => "Element.show('spinner')",
                 :success => "Element.hide('spinner')",
                 :url => appointments_url, :method => :get) %>
